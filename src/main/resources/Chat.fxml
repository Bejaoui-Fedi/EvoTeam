<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.effect.GaussianBlur?>

<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="tn.esprit.controllers.ChatController"
           prefWidth="800" prefHeight="650"
           stylesheets="@styles.css">

    <!-- ðŸŒ¿ Background nature apaisant -->
    <ImageView fitWidth="800" fitHeight="650" preserveRatio="false" styleClass="nature-background">
        <image>
            <Image url="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=1600&amp;q=80"
                   backgroundLoading="true"/>
        </image>
        <effect>
            <GaussianBlur radius="5"/>
        </effect>
    </ImageView>

    <!-- ðŸŒ¿ Overlay -->
    <Region styleClass="overlay"/>

    <!-- Contenu principal -->
    <BorderPane style="-fx-background-color: transparent; -fx-padding: 20;">

        <!-- Top: Header -->
        <top>
            <VBox alignment="CENTER" spacing="10" style="-fx-padding: 0 0 20 0;">
                <HBox alignment="CENTER" spacing="15">
                    <Label text="ðŸ§˜" style="-fx-font-size: 40; -fx-text-fill: #3A7D6B;"/>
                    <Label text="Coach Ã‰quilibre" styleClass="header-label" style="-fx-font-size: 32;"/>
                    <Label text="ðŸŒ¿" style="-fx-font-size: 40; -fx-text-fill: #3A7D6B;"/>
                </HBox>
                <Label text="Votre espace de dialogue pour le bien-Ãªtre mental et physique"
                       styleClass="subheader-label" style="-fx-font-size: 14;"/>

                <!-- Bouton Dashboard -->
                <HBox alignment="CENTER_RIGHT" style="-fx-padding: 10 0 0 0;">
                    <Button text="ðŸ  Dashboard"
                            onAction="#goToDashboard"
                            styleClass="button-secondary"
                            prefWidth="120" prefHeight="35"/>
                </HBox>
            </VBox>
        </top>

        <!-- Center: Chat Area -->
        <center>
            <VBox spacing="15" VBox.vgrow="ALWAYS">

                <!-- Zone de chat (scrollable) -->
                <ScrollPane fx:id="chatScrollPane"
                            fitToWidth="true"
                            VBox.vgrow="ALWAYS"
                            style="-fx-background-color: transparent; -fx-background: transparent; -fx-border-color: transparent;">

                    <VBox fx:id="chatContainer"
                          spacing="15"
                          style="-fx-padding: 15; -fx-background-color: transparent;"
                          minHeight="350"/>
                </ScrollPane>

                <!-- Indicateur de frappe -->
                <Label fx:id="typingIndicator"
                       text="ðŸŒ¿ Coach rÃ©flÃ©chit..."
                       style="-fx-text-fill: #7F8C8D; -fx-font-style: italic; -fx-padding: 5;"
                       visible="false" managed="false"/>

                <!-- Suggestions Container -->
                <VBox fx:id="suggestionsContainer"
                      spacing="10"
                      style="-fx-padding: 10; -fx-background-color: rgba(255,255,255,0.7); -fx-background-radius: 15; -fx-border-color: #3A7D6B; -fx-border-radius: 15; -fx-border-width: 1;"
                      visible="true" managed="true">
                    <Label text="Suggestions pratiques:"
                           style="-fx-font-weight: bold; -fx-text-fill: #3A7D6B; -fx-font-size: 13;"/>
                    <FlowPane fx:id="suggestionsFlowPane"
                              hgap="10" vgap="10"/>
                </VBox>

                <!-- Zone de saisie -->
                <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 10 0 0 0;">
                    <TextArea fx:id="messageInput"
                              promptText="Ã‰crivez votre message... (EntrÃ©e pour envoyer)"
                              HBox.hgrow="ALWAYS"
                              prefRowCount="3"
                              wrapText="true"
                              styleClass="chat-input"/>
                    <VBox spacing="5" alignment="CENTER">
                        <Button fx:id="sendButton"
                                text="Envoyer"
                                styleClass="button-primary"
                                prefWidth="100" prefHeight="40"/>
                        <Button fx:id="clearChatButton"
                                text="Effacer"
                                styleClass="button-secondary"
                                prefWidth="100" prefHeight="35"/>
                    </VBox>
                </HBox>
            </VBox>
        </center>

        <!-- Bottom: Footer -->
        <bottom>
            <HBox alignment="CENTER" style="-fx-padding: 20 0 5 0;">
                <VBox alignment="CENTER" spacing="3">
                    <Label text="ðŸŒ¿ Prenez soin de vous - Ã‰coutez votre corps ðŸ’š"
                           style="-fx-font-size: 12; -fx-text-fill: #3A7D6B;"/>
                    <Label text="Coach Ã‰quilibre - Votre compagnon bien-Ãªtre"
                           style="-fx-font-size: 10; -fx-text-fill: #6F9A8D;"/>
                </VBox>
            </HBox>
        </bottom>

    </BorderPane>
</StackPane>