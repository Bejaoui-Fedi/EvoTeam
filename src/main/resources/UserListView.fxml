<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.effect.GaussianBlur?>

<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="tn.esprit.controllers.UserListController"
           prefWidth="1120" prefHeight="800"
           stylesheets="@styles.css">

    <!-- Background moderne et Ã©purÃ© -->
    <ImageView fitWidth="1120" fitHeight="800" preserveRatio="false" styleClass="nature-background">
        <image>
            <Image url="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=1600&amp;q=80"
                   backgroundLoading="true"/>
        </image>
        <effect>
            <GaussianBlur radius="5"/>
        </effect>
    </ImageView>

    <!-- Overlay plus lÃ©ger -->
    <Region styleClass="overlay"/>

    <!-- Contenu principal - MÃŠME DESIGN, TAILLE RÃ‰DUITE -->
    <BorderPane style="-fx-background-color: transparent; -fx-padding: 15;">

        <!-- Header avec design minimaliste - PLUS COMPACT -->
        <top>
            <VBox spacing="5" style="-fx-padding: 0 0 15 0;">
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <Label text="ðŸ‘¥" style="-fx-font-size: 28; -fx-text-fill: #2C5F4B; -fx-background-color: rgba(255,255,255,0.9); -fx-padding: 8; -fx-background-radius: 50;"/>
                    <VBox spacing="2">
                        <Label text="Gestion des Utilisateurs" style="-fx-font-size: 22; -fx-font-weight: bold; -fx-text-fill: #2C5F4B;"/>
                        <Label text="GÃ©rez votre communautÃ© avec bienveillance" style="-fx-font-size: 12; -fx-text-fill: #5F9B8A;"/>
                    </VBox>
                </HBox>
            </VBox>
        </top>

        <!-- Center - MÃŠME ORGANISATION, TAILLES RÃ‰DUITES -->
        <center>
            <VBox spacing="15" VBox.vgrow="ALWAYS">

                <!-- Carte des statistiques - EN HAUT - PLUS COMPACTES -->
                <HBox spacing="15" HBox.hgrow="ALWAYS">
                    <!-- Carte Total -->
                    <VBox spacing="5" style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 8, 0, 0, 2);" HBox.hgrow="ALWAYS">
                        <Label text="Total" style="-fx-font-size: 12; -fx-text-fill: #7F8C8D;"/>
                        <Label fx:id="totalUsersLabel" text="0" style="-fx-font-size: 26; -fx-font-weight: bold; -fx-text-fill: #2C5F4B;"/>
                        <Label text="Utilisateurs" style="-fx-font-size: 11; -fx-text-fill: #95A5A6;"/>
                    </VBox>

                    <!-- Carte Actifs -->
                    <VBox spacing="5" style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 8, 0, 0, 2);" HBox.hgrow="ALWAYS">
                        <Label text="âœ… Actifs" style="-fx-font-size: 12; -fx-text-fill: #7F8C8D;"/>
                        <Label fx:id="activeUsersLabel" text="0" style="-fx-font-size: 26; -fx-font-weight: bold; -fx-text-fill: #27AE60;"/>
                        <Label text="Comptes actifs" style="-fx-font-size: 11; -fx-text-fill: #95A5A6;"/>
                    </VBox>

                    <!-- Carte Inactifs -->
                    <VBox spacing="5" style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 8, 0, 0, 2);" HBox.hgrow="ALWAYS">
                        <Label text="â¸ï¸ Inactifs" style="-fx-font-size: 12; -fx-text-fill: #7F8C8D;"/>
                        <Label fx:id="inactiveUsersLabel" text="0" style="-fx-font-size: 26; -fx-font-weight: bold; -fx-text-fill: #E74C3C;"/>
                        <Label text="Comptes inactifs" style="-fx-font-size: 11; -fx-text-fill: #95A5A6;"/>
                    </VBox>
                </HBox>

                <!-- Barre de recherche et filtres - MÃŠME DESIGN, PLUS COMPACT -->
                <VBox spacing="10" style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 8, 0, 0, 2);">

                    <!-- PremiÃ¨re ligne : Recherche et boutons -->
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <HBox spacing="8" HBox.hgrow="ALWAYS" style="-fx-background-color: #F5F7FA; -fx-background-radius: 8; -fx-padding: 0 8;">
                            <Label text="ðŸ”" style="-fx-font-size: 16; -fx-text-fill: #95A5A6;"/>
                            <TextField fx:id="searchField" promptText="Rechercher par nom, email ou tÃ©lÃ©phone..."
                                       HBox.hgrow="ALWAYS" style="-fx-background-color: transparent; -fx-padding: 8 0; -fx-border: none; -fx-font-size: 12;"/>
                        </HBox>

                        <Button text="+ Nouvel Utilisateur" onAction="#handleAddUser"
                                style="-fx-background-color: #2C5F4B; -fx-text-fill: white; -fx-font-size: 12; -fx-font-weight: bold; -fx-padding: 8 18; -fx-background-radius: 8; -fx-cursor: hand;"/>
                        <Button text="â†»" onAction="#handleRefresh"
                                style="-fx-background-color: #7F8C8D; -fx-text-fill: white; -fx-font-size: 14; -fx-padding: 8 12; -fx-background-radius: 8; -fx-cursor: hand;"
                                prefWidth="35"/>
                    </HBox>

                    <!-- DeuxiÃ¨me ligne : Filtres et infos -->
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <Label text="Filtres:" style="-fx-font-weight: bold; -fx-text-fill: #2C5F4B; -fx-font-size: 12;"/>

                        <HBox spacing="8" alignment="CENTER" style="-fx-background-color: #F5F7FA; -fx-background-radius: 8; -fx-padding: 4 8;">
                            <Label text="ðŸ‘¤ RÃ´le:" style="-fx-text-fill: #7F8C8D; -fx-font-size: 11;"/>
                            <ComboBox fx:id="roleFilterCombo" prefWidth="140" style="-fx-background-color: transparent; -fx-border: none; -fx-font-size: 11;"/>
                        </HBox>

                        <HBox spacing="8" alignment="CENTER" style="-fx-background-color: #F5F7FA; -fx-background-radius: 8; -fx-padding: 4 8;">
                            <Label text="âš¡ Statut:" style="-fx-text-fill: #7F8C8D; -fx-font-size: 11;"/>
                            <ComboBox fx:id="statusFilterCombo" prefWidth="120" style="-fx-background-color: transparent; -fx-border: none; -fx-font-size: 11;"/>
                        </HBox>

                        <Button fx:id="clearFiltersButton" text="âœ– Effacer" onAction="#handleClearFilters"
                                style="-fx-background-color: transparent; -fx-text-fill: #E74C3C; -fx-border-color: #E74C3C; -fx-border-radius: 8; -fx-padding: 5 15; -fx-cursor: hand; -fx-font-size: 11;"/>

                        <Region HBox.hgrow="ALWAYS"/>

                        <Label fx:id="searchInfoLabel" text="ðŸ“‹ Tous les utilisateurs"
                               style="-fx-text-fill: #2C5F4B; -fx-font-weight: 600; -fx-background-color: #E8F5E9; -fx-padding: 5 12; -fx-background-radius: 15; -fx-font-size: 11;"/>
                    </HBox>
                </VBox>

                <!-- Tableau - MÃŠME DESIGN, TAILLE AJUSTÃ‰E -->
                <TableView fx:id="userTable" VBox.vgrow="ALWAYS"
                           style="-fx-font-size: 12; -fx-background-color: white; -fx-background-radius: 12; -fx-border-color: transparent; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 8, 0, 0, 2);"
                           prefHeight="350">
                    <columns>
                        <TableColumn fx:id="idColumn" text="ID" prefWidth="45"/>
                        <TableColumn fx:id="nomColumn" text="Nom complet" prefWidth="160"/>
                        <TableColumn fx:id="emailColumn" text="Adresse email" prefWidth="200"/>
                        <TableColumn fx:id="roleColumn" text="RÃ´le" prefWidth="130"/>
                        <TableColumn fx:id="telephoneColumn" text="TÃ©lÃ©phone" prefWidth="110"/>
                        <TableColumn fx:id="actifColumn" text="Statut" prefWidth="80"/>
                        <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="170"/>
                    </columns>
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>
                </TableView>

                <!-- Statistiques par rÃ´le - DESIGN EN LIGNE, PLUS COMPACT -->
                <HBox spacing="12" alignment="CENTER_LEFT" style="-fx-background-color: white; -fx-background-radius: 8; -fx-padding: 10 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.05), 5, 0, 0, 1);">
                    <Label text="RÃ©partition:" style="-fx-font-weight: bold; -fx-text-fill: #2C5F4B; -fx-font-size: 12;"/>

                    <HBox spacing="15" alignment="CENTER">
                        <HBox spacing="5" alignment="CENTER" style="-fx-background-color: #F3E8FF; -fx-padding: 3 12; -fx-background-radius: 15;">
                            <Label text="ðŸ‘‘" style="-fx-font-size: 12;"/>
                            <Label fx:id="adminCountLabel" text="0 Admin(s)"
                                   style="-fx-text-fill: #8E44AD; -fx-font-weight: 600; -fx-font-size: 11;"/>
                        </HBox>

                        <HBox spacing="5" alignment="CENTER" style="-fx-background-color: #E3F2FD; -fx-padding: 3 12; -fx-background-radius: 15;">
                            <Label text="ðŸ§ " style="-fx-font-size: 12;"/>
                            <Label fx:id="psyCountLabel" text="0 Psy/Coach"
                                   style="-fx-text-fill: #1976D2; -fx-font-weight: 600; -fx-font-size: 11;"/>
                        </HBox>

                        <HBox spacing="5" alignment="CENTER" style="-fx-background-color: #E8F5E9; -fx-padding: 3 12; -fx-background-radius: 15;">
                            <Label text="ðŸ¤" style="-fx-font-size: 12;"/>
                            <Label fx:id="patientCountLabel" text="0 Patient(s)"
                                   style="-fx-text-fill: #2E7D32; -fx-font-weight: 600; -fx-font-size: 11;"/>
                        </HBox>
                    </HBox>

                    <Region HBox.hgrow="ALWAYS"/>

                    <Label text="ðŸŒ¿ CommunautÃ© bienveillante" style="-fx-text-fill: #5F9B8A; -fx-font-style: italic; -fx-font-size: 11;"/>
                </HBox>

            </VBox>
        </center>

        <!-- Footer Ã©purÃ© - PLUS COMPACT -->
        <bottom>
            <HBox alignment="CENTER" style="-fx-padding: 15 0 0 0;">
                <Label text="Â© 2026 Evolia - Gestion des utilisateurs"
                       style="-fx-text-fill: #95A5A6; -fx-font-size: 11;"/>
            </HBox>
        </bottom>

    </BorderPane>
</StackPane>