<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.image.Image?>
<?import javafx.scene.effect.GaussianBlur?>

<StackPane xmlns="http://javafx.com/javafx"
           xmlns:fx="http://javafx.com/fxml"
           fx:controller="tn.esprit.controllers.admin.AdminSupervisionConsultationController"
           prefWidth="1400" prefHeight="800"
           stylesheets="@../../css/styles.css">

    <!-- Background nature -->
    <ImageView fitWidth="1400" fitHeight="800" preserveRatio="false" styleClass="nature-background">
        <image>
            <Image url="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=1600&amp;q=80"
                   backgroundLoading="true"/>
        </image>
        <effect>
            <GaussianBlur radius="5"/>
        </effect>
    </ImageView>

    <!-- Overlay -->
    <Region styleClass="overlay"/>

    <!-- Main HBox with Sidebar + Content -->
    <HBox spacing="0" alignment="CENTER">

        <!-- SIDEBAR -->
        <VBox style="-fx-background-color: #396f5b;
                     -fx-background-radius: 0;
                     -fx-padding: 0;
                     -fx-pref-width: 280;
                     -fx-max-height: 800;"
              alignment="TOP_CENTER">

            <!-- Logo Header -->
            <VBox alignment="CENTER" spacing="10" style="-fx-background-color: #396f5b; -fx-padding: 30 20 20 20; -fx-pref-width: 280;">
                <Label text="ðŸŒ¿" style="-fx-font-size: 48; -fx-text-fill: white; -fx-effect: dropshadow(gaussian, rgba(255,255,255,0.3), 10, 0, 0, 2);"/>
                <Label text="EVOLIA" style="-fx-font-size: 22; -fx-font-weight: bold; -fx-text-fill: white;"/>
                <Label text="ADMIN" style="-fx-font-size: 14; -fx-text-fill: #E0F2E0; -fx-background-color: rgba(255,255,255,0.15); -fx-padding: 5 20; -fx-background-radius: 20;"/>
            </VBox>

            <Separator style="-fx-background-color: rgba(255,255,255,0.2); -fx-pref-height: 1.5; -fx-pref-width: 220; -fx-padding: 5 0;"/>

            <!-- Menu Sections -->
            <VBox spacing="15" style="-fx-padding: 20 15 20 15;" VBox.vgrow="ALWAYS">

                <Button text="ðŸ“Š Tableau de bord"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 15;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;"/>

                <Button text="ðŸ‘¥ Utilisateurs"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 15;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;"/>

                <Button text="ðŸ“… Rendez-vous" onAction="#retourSupervisionRdv"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 15;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;"/>

                <Button text="ðŸ“‹ Consultations"
                        style="-fx-background-color: rgba(255,255,255,0.2); -fx-text-fill: white; -fx-font-size: 15; -fx-font-weight: bold;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;
                               -fx-border-color: white; -fx-border-width: 0 0 0 4;"/>

                <Button text="ðŸ§˜ Exercices"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 15;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;"/>

                <Button text="ðŸ“… Ã‰vÃ©nements"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 15;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;"/>

                <Button text="ðŸ’š Bien-Ãªtre"
                        style="-fx-background-color: transparent; -fx-text-fill: white; -fx-font-size: 15;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;"/>
            </VBox>

            <Region VBox.vgrow="ALWAYS"/>

            <!-- Footer -->
            <VBox alignment="CENTER" spacing="10" style="-fx-background-color: #396f5b; -fx-padding: 20 0 30 0; -fx-pref-width: 280;">
                <Separator style="-fx-background-color: rgba(255,255,255,0.2); -fx-pref-height: 1.5; -fx-pref-width: 220;"/>
                <Button text="ðŸšª DÃ©connexion"
                        style="-fx-background-color: rgba(255,255,255,0.1); -fx-text-fill: white; -fx-font-size: 15;
                               -fx-alignment: CENTER_LEFT; -fx-pref-width: 230; -fx-pref-height: 40;
                               -fx-padding: 0 0 0 20; -fx-background-radius: 10; -fx-cursor: hand;"/>
            </VBox>
        </VBox>

        <!-- MAIN CONTENT -->
        <BorderPane style="-fx-background-color: transparent; -fx-padding: 20;" HBox.hgrow="ALWAYS">

            <!-- Header -->
            <top>
                <VBox alignment="CENTER" spacing="10" style="-fx-padding: 20 0 20 0;">
                    <HBox alignment="CENTER" spacing="15">
                        <Label text="ðŸ“‹" style="-fx-font-size: 40; -fx-text-fill: #3A7D6B;"/>
                        <Label text="Supervision des Consultations" styleClass="header-label" style="-fx-font-size: 32;"/>
                        <Label text="ðŸŒ¿" style="-fx-font-size: 40; -fx-text-fill: #3A7D6B;"/>
                    </HBox>
                    <Label text="Suivi dÃ©taillÃ© des dossiers mÃ©dicaux" styleClass="subheader-label"/>
                </VBox>
            </top>

            <!-- Center Content -->
            <center>
                <VBox spacing="15" styleClass="card" style="-fx-padding: 20; -fx-background-color: rgba(255,255,255,0.7);"
                      VBox.vgrow="ALWAYS">

                    <!-- Search and Filter Bar -->
                    <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 20 20 10 20;">
                        <TextField fx:id="searchField" promptText="Rechercher par ID, diagnostic..."
                                   prefWidth="300" styleClass="text-field"/>
                        <Button text="Rechercher" styleClass="button-primary"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label text="ðŸ“… Date :" styleClass="normal-label" style="-fx-font-weight: bold;"/>
                        <DatePicker fx:id="dateFilterPicker" prefWidth="150" styleClass="text-field"/>
                        <Label text="ðŸ“Š Statut :" styleClass="normal-label" style="-fx-font-weight: bold;"/>
                        <ChoiceBox fx:id="statutFilterChoice" prefWidth="120" styleClass="text-field"/>
                        <Button text="â†» Actualiser" onAction="#refresh" styleClass="button-primary"/>
                    </HBox>

                    <!-- Table -->
                    <TableView fx:id="tableView" VBox.vgrow="ALWAYS"
                               style="-fx-font-size: 13; -fx-background-color: transparent; -fx-border-color: #D4E8D0; -fx-border-radius: 15; -fx-padding: 5;"
                               prefHeight="450">
                        <columns>
                            <TableColumn fx:id="colId" text="ID" prefWidth="50"
                                         style="-fx-alignment: CENTER; -fx-background-color: #F0F9EC;"/>
                            <TableColumn fx:id="colAppointmentId" text="RDV #" prefWidth="70"/>
                            <TableColumn fx:id="colDate" text="Date" prefWidth="100"/>
                            <TableColumn fx:id="colDiagnostic" text="Diagnostic" prefWidth="200"/>
                            <TableColumn fx:id="colObservation" text="Observations" prefWidth="150"/>
                            <TableColumn fx:id="colTraitement" text="Traitement" prefWidth="120"/>
                            <TableColumn fx:id="colOrdonnance" text="Ordonnance" prefWidth="150"/>
                            <TableColumn fx:id="colDuree" text="DurÃ©e" prefWidth="70"/>
                            <TableColumn fx:id="colStatut" text="Statut" prefWidth="100"
                                         style="-fx-alignment: CENTER;"/>
                        </columns>
                        <columnResizePolicy>
                            <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                        </columnResizePolicy>
                    </TableView>

                    <!-- Stats Bar -->
                    <HBox spacing="20" style="-fx-padding: 15 20; -fx-background-color: rgba(225,240,218,0.8); -fx-background-radius: 15; -fx-border-color: #B5D3A7; -fx-border-radius: 15; -fx-border-width: 1;"
                          alignment="CENTER_LEFT">
                        <HBox spacing="10" alignment="CENTER">
                            <Label text="ðŸ“Š" style="-fx-font-size: 18; -fx-text-fill: #3A7D6B;"/>
                            <Label fx:id="totalLabel" text="Total: 0 consultations"
                                   style="-fx-font-weight: bold; -fx-text-fill: #3A7D6B; -fx-font-size: 15;"/>
                        </HBox>
                        <Separator orientation="VERTICAL" style="-fx-background-color: #B5D3A7; -fx-pref-height: 30;"/>
                        <Label fx:id="statsLabel" text="Stats..."
                               style="-fx-text-fill: #5F9B8A; -fx-font-size: 14;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <HBox spacing="5" alignment="CENTER">
                            <Label text="ðŸŒ¿" style="-fx-font-size: 16; -fx-text-fill: #5F9B8A;"/>
                            <Label text="CommunautÃ© bienveillante"
                                   style="-fx-text-fill: #5F9B8A; -fx-font-style: italic; -fx-font-size: 14;"/>
                        </HBox>
                    </HBox>

                    <!-- Action Buttons -->
                    <HBox spacing="20" alignment="CENTER_RIGHT" style="-fx-padding: 10 20;">
                        <Button fx:id="retourButton" text="â† Retour aux RDV"
                                onAction="#retourSupervisionRdv"
                                styleClass="button-secondary"/>
                        <Button fx:id="deleteButton" text="ðŸ—‘ï¸ Supprimer la consultation"
                                onAction="#deleteConsultation" disable="true"
                                styleClass="button-danger"/>
                    </HBox>

                </VBox>
            </center>

            <!-- Footer -->
            <bottom>
                <HBox alignment="CENTER" style="-fx-padding: 20 0 10 0;">
                    <VBox alignment="CENTER" spacing="5">
                        <Label text="ðŸŒ¿  Bienveillance â€¢ Respect â€¢ Accompagnement  ðŸ’™"
                               style="-fx-font-size: 14; -fx-text-fill: #3A7D6B;"/>
                        <Label text="Â© 2026 EvoTeam - Gestion des consultations"
                               style="-fx-font-size: 12; -fx-text-fill: #6F9A8D;"/>
                    </VBox>
                </HBox>
            </bottom>

        </BorderPane>

    </HBox>
</StackPane>